<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

  <head>
    <title>ISISCC Fantasy Cricket League</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
	body {	font-family: Verdana, Geneva, sans-serif; background-color: gray;}
	table { float:none; text-align: center; margin-top:20px; width: 100%; font-size: 90%; }
	th td { padding:10px; margin: 5px; }
	h2{ text-align: center;	}	    

	.centertext{ text-align:center;}
	.whitetext{color: white;}
	.frame { background-color:white; padding:2px; margin:5px; height: 100%;}
	.framesplit {float:left; width:48%;padding:2px;}
	.bottom {clear:both;}
	.playerselectdiv { margin-bottom: 3%; margin-top:3%; padding: 5px; }
	.ui-helper-hidden, .ui-helper-hidden-accessible {display: none;}	
    .ui-menu-item {list-style-type: none; color: white; text-align:left;}
	.infchart {width:50%; height:80%;}
	.overview {text-align:center; margin:auto; }
	.players {text-align:center;}
	.chart {color: blue;}
	.playerbutton {background-color:white; font-weight: bold; border-color: white; border:5px; margin: 5px;
			      padding: 5px; border-radius:5%;}
    .modal-dialog{overflow-y: initial !important}
    .w3-container{height: 80vh; overflow-y: auto;}
    .detail {display: none; min-width:40px;font-size: 80%;}
	.grid-container {display: grid;
			grid-template-columns: auto auto;}
	.grid-item {padding: 1px;
		}
	.sortbutton {    color: black;
			border: none;
			outline: none;
			background-color: inherit;
			margin-left: none;
			padding: 1px;
			font-weight: bolder;
	}
	.hvr:hover {
	color:blue;
	}
	
    #faq { font-family: Verdana, Geneva, sans-serif; position:fixed; top:0; right:0; width: 100px; font-size: 18px; 
	  padding: 10px; margin:10px; border: none; background: #fff; color: #000; cursor: pointer; float:right;}
    #faq:hover {  background: #ddd;  color: black;}
    @media only screen and (max-width: 600px) {
        .framesplit {width: 100%;}
		.pointsinfo {max-width: 600px;}
		}

    </style>
	
  <script src="https://ravikirankella.github.io/Cricket/FantasyLeague.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/danfojs@1.1.0/lib/bundle.min.js"></script> 

 
  <script>
	var teamsdata="";
	var scores="";
	var fl_points=new dfd.DataFrame();
	var fl_points_hdr=[];
	var doc_ready=false;

	function loadTeamsData() {
			console.log('loadTeamsData');

			var xmlhttp = new XMLHttpRequest();
			var spreadsheetid="1N_7zBkeG0nXopwAdK2UOtR_RLuS0cfksrwni86OJMhk";
			var spreadsheetrange="Auction2022!A2:G";
			var url = "https://sheets.googleapis.com/v4/spreadsheets/"+spreadsheetid+"/values/"+spreadsheetrange+"?key=AIzaSyAmi4pvsmS6iGokKlVXGxsFbKxpAnWjWEo";
			xmlhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
					var myArr = JSON.parse(this.responseText);
					teamsdata=myArr["values"];
					getscores();
					AddTable(teamsdata);
					}
					
			};
			xmlhttp.open("GET", url, true);
			xmlhttp.send();
		}
	function getscores() {
			console.log('getscores');

			var xmlhttp = new XMLHttpRequest();
			var spreadsheetid="1N_7zBkeG0nXopwAdK2UOtR_RLuS0cfksrwni86OJMhk";
			var spreadsheetrange="Scores2022!A1:O";
			var url = "https://sheets.googleapis.com/v4/spreadsheets/"+spreadsheetid+"/values/"+spreadsheetrange+"?key=AIzaSyAmi4pvsmS6iGokKlVXGxsFbKxpAnWjWEo";
			xmlhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
					var myArr = JSON.parse(this.responseText);
					scores=myArr["values"];
					computeuncapped(scores);
					fl_leaderboard();
					}
					
			};
			xmlhttp.open("GET", url, true);
			xmlhttp.send();
		}
	
	  function fl_leaderboard(){
		  let scoreshdr=scores[0];  	  
		  scoresdata = new dfd.DataFrame(scores.slice(1),{columns:scoreshdr});
		  nominations = new dfd.DataFrame(teamsdata,{columns:["PlayerNomination","PricePaid","Team","EstimatedPoints","Capped?","Category","Player"]});	
		  fl_points=dfd.merge({left:nominations,right:scoresdata,on:["Player"],how:"inner"});
		  fl_points.resetIndex({inplace: true });
		  fl_points_hdr=fl_points.columns;
		  fl_points.addColumn("Points",fl_points.apply(calculate_fl_points),{ inplace: true });
		  fl_points.addColumn("PointsDetail",fl_points.apply(calculate_fl_points_with_detail),{ inplace: true });
		  document.getElementById("leaderboardhdr").innerHTML='<h2 class="chart" OnClick="AddChart(\'All\')"><u>Leader Board</u><sup> new</sup></h2>';
		  print_grouped_info(fl_points,document.getElementById("leaderboard"),"Team","Points");
		  doc_ready=true;
	  }
	  
	  function print_grouped_info(data,node,columnname="Team",sumcol="Points"){
		  let grp=data.groupby([columnname]);
		  let print_data=grp.col([sumcol]).sum();
		  print_data.sortValues(sumcol+"_sum", {ascending:false, inplace: true });
		  print_data.resetIndex({inplace: true });
		  
		  let table_data='<table><tr><th>'+columnname+'</th><th>'+sumcol+'</th></tr>';
		  for (i=0;i<print_data.shape[0];i++){
			table_data+='<tr>';
			for (j=0;j<print_data.shape[1];j++){
				if(columnname=="PlayerNomination"){
			   table_data+='<td class=\"hvr\" onclick="popup(\''+print_data.iat(i,0)+'\')" title="click to see detail">'+print_data.iat(i,j)+'</td>';
			   }
			   else {
			   table_data+='<td>'+print_data.iat(i,j)+'</td>';
			   }
			}
			table_data+='</tr>';
		  }
		  table_data+='</table>';
		  node.innerHTML=String(table_data);
	  }
	  
     function print_table(table,node){
		  let table_data='<table><tr>';
		  let table_hdr=table.columns;
		  for (i=0;i<table_hdr.length;i++){
			table_data+='<th>'+table_hdr[i]+'</th>';
		  }
		  table_data+='</tr>';
		  for (i=0;i<table.shape[0];i++){
			table_data+='<tr>';
			for (j=0;j<table.shape[1];j++){
			   table_data+='<td>'+table.iat(i,j)+'</td>';
			}
			table_data+='</tr>';
		  }
		  table_data+='</table>';
		  node.innerHTML=String(table_data);
	  
	  }

     function table_html(table){
		  let table_data='<table><tr>';
		  let table_hdr=table.columns;
		  for (i=0;i<table_hdr.length;i++){
			table_data+='<th>'+table_hdr[i]+'</th>';
		  }
		  table_data+='</tr>';
		  for (i=0;i<table.shape[0];i++){
			table_data+='<tr>';
			for (j=0;j<table.shape[1];j++){
			   table_data+='<td>'+table.iat(i,j)+'</td>';
			}
			table_data+='</tr>';
		  }
		  table_data+='</table>';
		  return table_data;
	  }	  
	  
     function popup(player){
		  let cond=fl_points["PlayerNomination"].eq(player);
		  let playerinfo=fl_points.loc({rows:cond});
		  document.getElementById('playernomination').innerHTML=player;
		  if (playerinfo.shape[0]==0){
		  document.getElementById('pointsinfo').innerHTML="<p style=\"text-align: center\">No data to display<p>";
		  }
		  else {
			  playerinfo=playerinfo.loc({columns:["GameId","GameName","Won?","Player","Points","PointsDetail"]});
			  playerinfo.sortValues("GameId", {ascending:false, inplace: true });
			  print_table(playerinfo,document.getElementById('pointsinfo'));
		  }
		  document.getElementById('id01').style.display='block'
       }
	  
	  function calculate_fl_points_with_detail(row,with_notes=true){
		  let pointsdetail=calculate_fl_points(row,with_notes);
		  return pointsdetail;
	  }
	  
	  function calculate_fl_points(row,with_notes=false){
		  let points=0;
		  let category=row[fl_points_hdr.indexOf('Category')];
		  let isCapped=row[fl_points_hdr.indexOf('Capped?')];
		  let player=row[fl_points_hdr.indexOf('Player')];
		  let note="";
		  //console.log(fl_points_hdr);
		  //console.log(row);
		  //console.log(player,category);
		  if (with_notes){console.log(category,isCapped,player);}
		  
		  if ((category=="Batter") || (category=="SuperBatter") || (category=="AllRounder") || (category=="SuperAllRounder")){
			let runs=(parseInt(row[fl_points_hdr.indexOf('Runs')])|| 0);
			if (with_notes){console.log(runs);}
			points=points+(runs*1);
			note+=runs.toString()+" Runs *1 = "+points.toString()+"<br>";
			//console.log("Batting Runs",runs,points);
			points=points+((parseInt(row[fl_points_hdr.indexOf('Sixes')])|| 0)*5);	
			note+=row[fl_points_hdr.indexOf('Sixes')]+" Sixes *10 = "+points.toString()+"<br>";
			//console.log("Batting Sixes",points);
		  }
		  
		  if ((category=="Bowler") || (category=="SuperBowler") || (category=="AllRounder") || (category=="SuperAllRounder")){
			//console.log("Bowling Wickets",points);
			points=points+((parseInt(row[fl_points_hdr.indexOf('Wkts')])|| 0)*20);
			note+=(parseInt(row[fl_points_hdr.indexOf('Wkts')])|| 0).toString()+" Wickets * 20= "+points.toString()+"<br>";
			//console.log("Bowling Wickets",points);
			points=points+((parseInt(row[fl_points_hdr.indexOf('Mdns')])|| 0)*5);
			note+=(parseInt(row[fl_points_hdr.indexOf('Mdns')])|| 0).toString()+" Maidens * 10= "+points.toString()+"<br>";
			//console.log("Bowling Mdns",points);
		  }	
		  if ((category=="SuperBatter") || (category=="SuperBowler") || (category=="SuperAllRounder")){
			points=points*2
			note+="Super cat double up ="+points.toString()+"<br>";
			//console.log("superdoube",points);
		  }
		  if ((category=="Batter") || (category=="SuperBatter") || (category=="AllRounder") || (category=="SuperAllRounder")){
			let howout=row[fl_points_hdr.indexOf('HowOut')];
			if ((howout=="Not Out") || (howout=="LBW") || (howout=="Run Out")) {
			points=points+5;
			note+="Batting bonus +5 ="+points.toString()+"<br>";
			}
			else {
			note+="Batting bonus +0 ="+points.toString()+"<br>";
			}
		  if ((category=="Bowler") || (category=="SuperBowler") || (category=="AllRounder") || (category=="SuperAllRounder")){
			let overs=(parseInt(row[fl_points_hdr.indexOf('Overs')])|| 0);
			let minovers=Math.round((parseInt(row[fl_points_hdr.indexOf('MaxPerBowler')])|| 0)/2,0);
			if ((overs!=0) && (overs<minovers)){
			points=points+5;
			note+="Bowling bonus +5 ="+points.toString()+"<br>";
			}
			else {
			note+="Bowling bonus +0 ="+points.toString()+"<br>";
			}
		  }	

		  }
		  if (parseInt(isCapped)==1){	
			points=points+10;
			note+="Game played +10 ="+points.toString()+"<br>";
			//console.log("Capped Match points",points);
			points=points+((parseInt(row[fl_points_hdr.indexOf('Catches')])|| 0)*10);
			note+=(parseInt(row[fl_points_hdr.indexOf('Catches')])|| 0).toString()+" Catches * 10= "+points.toString()+"<br>";
			points=points+((parseInt(row[fl_points_hdr.indexOf('Runouts')])|| 0)*10);
			note+=(parseInt(row[fl_points_hdr.indexOf('Runouts')])|| 0).toString()+" Runouts * 10= "+points.toString()+"<br>";
			//console.log("Capped catches",points);		
		  }	  
		  
		  if (parseInt(row[fl_points_hdr.indexOf('Won?')])==1){
			points=Math.round((points*1.25)-0.5,0);
			note+="Winning game 25% bonus ="+points.toString()+"<br>";
			//console.log("Won 25%",points);
			}
		  if ((parseInt(row[fl_points_hdr.indexOf('PointsMultiplier')])|| 1)!=1){
		  points=points*(parseInt(row[fl_points_hdr.indexOf('PointsMultiplier')])|| 1);
		  note+="Tour/nonStats bonus * "+(parseInt(row[fl_points_hdr.indexOf('PointsMultiplier')])|| 1).toString()+"="+points.toString()+"<br>";
		  //console.log("multiplier",points);
		  }
		  
		  if (with_notes){
		  points='<p onclick=showhide(this)>Click here to show detail</p><p class="detail">'+note+'</p>';
		  }
		  
		  return points;
	  }
	  function showhide(node){
		   let text=node.innerHTML;
		   if (text=="Click here to show detail"){
		   node.innerHTML='Hide detail';
		   
		   let child=node.parentNode.lastChild;
		   child.style.display = "block"
		   }
		   else {
		   node.innerHTML='Click here to show detail';
		   let child=node.parentNode.lastChild;
		   child.style.display = "None"
		   }
	   }
		
	  function computeuncapped(scores) {
	  
		  let scoreshdr=scores[0];
		  //console.log(teamsdata);
			  
		  scoresdata = new dfd.DataFrame(scores.slice(1),{columns:scoreshdr});
		  nominations = new dfd.DataFrame(teamsdata,{columns:["PlayerNomination","PricePaid","Team","EstimatedPoints","Capped?","Category","Player"]});
		  let uncapped_df=dfd.merge({left:scoresdata,right:nominations,on:["Player"],how:"left"});
		  cond=uncapped_df["Capped?"].isNa()
		  uncapped_batters=uncapped_df.loc({rows:cond,columns:["GameId","GameName","Player","Sixes","Runs","Won?","PointsMultiplier"]});
		  uncapped_batters.addColumn("Points",uncapped_batters.apply(calculate_uncapped_batter_points),{ inplace: true });
		  uncapped_batters=uncapped_batters.groupby(['Player']).col(['Points']).sum();
		  uncapped_batters.sortValues("Points_sum", {ascending:false, inplace: true });
		  uncapped_batters.resetIndex({inplace: true });
		  
		  uncapped_bowlers=uncapped_df.loc({rows:cond,columns:["GameId","GameName","Player","Mdns","Wkts","Won?","PointsMultiplier"]});
		  console.log(uncapped_bowlers);
		  uncapped_bowlers.addColumn("Points",uncapped_bowlers.apply(calculate_uncapped_bowler_points),{ inplace: true });
		  uncapped_bowlers=uncapped_bowlers.groupby(['Player']).col(['Points']).sum();
		  uncapped_bowlers.sortValues("Points_sum", {ascending:false, inplace: true });
		  uncapped_bowlers.resetIndex({inplace: true });
		  
		  console.log(uncapped_bowlers.shape[0]);
		  for (i=0;i<uncapped_batters.shape[0];i++) {
			
			for(j = 0; j < teamsdata.length; j++) {
				if (teamsdata[j][0]=="Uncapped (Batter) "+(i+1).toString()){
				console.log(teamsdata[j]);
				teamsdata[j][6]=uncapped_batters.at(i,"Player");
				console.log(teamsdata[j]);
				}
			}
		  }
		  for (i=0;i<uncapped_bowlers.shape[0];i++) {
			
			for(j = 0; j < teamsdata.length; j++) {
				if (teamsdata[j][0]=="Uncapped (Bowler) "+(i+1).toString()){
				console.log(teamsdata[j]);
				teamsdata[j][6]=uncapped_bowlers.at(i,"Player");
				console.log(teamsdata[j]);
				}
			}
		  }
		  

	  }
	  
	  function calculate_uncapped_batter_points(row) {
		cols=["GameId","GameName","Player","Sixes","Runs","Won?","PointsMultiplier"];
		let points=(((parseInt(row[cols.indexOf('Sixes')])|| 0)*5)+(parseInt(row[cols.indexOf('Runs')])|| 0));
		if (parseInt(row[cols.indexOf('Won?')])==1){
		points=Math.round((points*1.25)-0.5,0);
		}
		points=points*parseInt(row[cols.indexOf('PointsMultiplier')]);
		return points;
	}
	  function calculate_uncapped_bowler_points(row) {
		cols=["GameId","GameName","Player","Mdns","Wkts","Won?","PointsMultiplier"];
		let points=(((parseInt(row[cols.indexOf('Mdns')])|| 0)*5)+(parseInt(row[cols.indexOf('Wkts')]) || 0)*20);
				if (parseInt(row[cols.indexOf('Won?')])==1){
		points=Math.round((points*1.25)-0.5,0);
		}
		points=points*parseInt(row[cols.indexOf('PointsMultiplier')]);
		return points;
	}	  
	  

	  
	  	function addTeamTable(teamnode) {
			var teamname=teamnode.innerHTML;
			var btns = document.getElementsByClassName("playerbutton");
			for (i = 0; i < btns.length; i++) {
				btns[i].style.backgroundColor = "white";
                                btns[i].style.color = "black";

					}
			teamnode.style.backgroundColor = "blue";
                        teamnode.style.color = "white";	
			if (teamname=="Clear Selection"){
				teamname="All";
				teamnode.style.backgroundColor = "white";
                                teamnode.style.color = "black";
			}
			if (teamname=='Games'){
			addgameinfo();
			}
			else {
			AddTable(teamsdata,teamname);
			}
		}
		
	  function addgameinfo(){
	  if (doc_ready) {
	    document.getElementById("leaderboardhdr").innerHTML='<h2>Games so far..</h2>';
		let games=fl_points.groupby(['GameId','GameName','Won?']).col(['Points']).sum();
		games.sortValues("GameId", {ascending:false, inplace: true });
		//document.getElementById("leaderboard").innerHTML=fl_points;
		document.getElementById("leaderboard").innerHTML="";
		//games.plot("leaderboard").table();
		var tabledata="<table><tr><th>GameId<button class=\"sortbutton\"  onclick=\"sortTable_asc(0,'GameId',this,'int')\">&uarr;&darr;</button></th>";
		tabledata+="<th>GameName<button class=\"sortbutton\" onclick=\"sortTable_asc(1,'GameName',this,'text')\">&uarr;&darr;</button></th>";
		tabledata+="<th>Won?<button class=\"sortbutton\" onclick=\"sortTable_asc(2,'Won?',this,'text')\">&uarr;&darr;</button></th>";
		tabledata+="<th>Points<button class=\"sortbutton\" onclick=\"sortTable_asc(3,'Points',this,'text')\">&uarr;&darr;</button></th></tr>";
		for(i = 0; i < games.shape[0]; i++) {
			tabledata=tabledata+"<tr class=\"hvr\" onclick=\"scorecard('"+games.iat(i,0)+"','"+games.iat(i,1)+"')\">";
			tabledata=tabledata+"<td>"+games.iat(i,0)+"</td>";
			tabledata=tabledata+"<td>"+games.iat(i,1)+"</td>";
			tabledata=tabledata+"<td>"+games.iat(i,2)+"</td>";
			tabledata=tabledata+"<td>"+games.iat(i,3)+"</td>";
			tabledata=tabledata+"</tr>";
			}
		document.getElementById("leaderboard").innerHTML=tabledata+"</table>";
		}
	  }
	  
	  function scorecard(GameId,GameName){
		  let cond=fl_points["GameId"].eq(GameId);
		  let game_points=fl_points.loc({rows:cond});
		  let pop_up_data="";
		  let scoreshdr=scores[0];
		  let game_scoresdata = new dfd.DataFrame(scores.slice(1),{columns:scoreshdr});
		  cond=game_scoresdata["GameId"].eq(GameId);
		  game_scoresdata=game_scoresdata.loc({rows:cond});
		  document.getElementById('playernomination').innerHTML=GameId+"-"+GameName;
		  if (game_points.shape[0]==0){
		  document.getElementById('pointsinfo').innerHTML="<p style=\"text-align: center\">No data to display<p>";
		  }
		  else {
			  game_points=game_points.loc({columns:["Team","PlayerNomination","Points","PointsDetail"]});
			  game_points.sortValues("Points", {ascending:false, inplace: true });
			  let game_table_data=table_html(game_points);
			  let batting_card=table_html(game_scoresdata.loc({columns:["Player","HowOut","Sixes","Runs"]}));
			  cond=game_scoresdata["Overs"].ne('');
			  let bowling_card=table_html(game_scoresdata.loc({rows:cond,columns:["Player","Overs","Mdns","RunsScored","Wkts"]}));
			  cond=game_scoresdata["Catches"].ne('0');
			  let catches_card=table_html(game_scoresdata.loc({rows:cond,columns:["Player","Catches"]}));
			  cond=game_scoresdata["Runouts"].ne('0');
			  let runouts_card=table_html(game_scoresdata.loc({rows:cond,columns:["Player","Runouts"]}));			  
			  pop_up_data=pop_up_data+"<h3 class=\"centertext\"><b>Batting Card</b></h3>";
			  pop_up_data=pop_up_data+batting_card;
			  pop_up_data=pop_up_data+"<h3 class=\"centertext\"><b>Bowling Card</b></h3>";
			  pop_up_data=pop_up_data+bowling_card;
			  pop_up_data=pop_up_data+"<h3 class=\"centertext\"><b>Catches & Runouts</b></h3>";
			  pop_up_data=pop_up_data+"<div class=\"grid-container\">";
			  pop_up_data=pop_up_data+"<div class=\"grid-item\">"+catches_card+"</div>";
			  pop_up_data=pop_up_data+"<div class=\"grid-item\">"+runouts_card+"</div>";
			  pop_up_data=pop_up_data+"</div><br>";
			  pop_up_data=pop_up_data+"<h3 class=\"centertext\"><b>Points in this game</h3>";
			  pop_up_data=pop_up_data+game_table_data;

			  
			  document.getElementById('pointsinfo').innerHTML=pop_up_data;
		  }
		  document.getElementById('id01').style.display='block'
       }
	  
	  
	  	function AddTable(teamdata,teamname="All") {
		var tablerow;
		var tablecol1;
		var tablecol2;
		var tablecol3;
		var tabledata="<tr><th>Player Nomination<button class=\"sortbutton\" onclick=\"sortTable_asc(0,'Player Nomination',this,'text')\">&uarr;&darr;</button></th>";
		tabledata+="<th>Price Paid<button class=\"sortbutton\" onclick=\"sortTable_asc(1,'Price Paid',this,'int')\">&uarr;&darr;</button></th>";
		tabledata+="<th>Team<button class=\"sortbutton\" onclick=\"sortTable_asc(2,'Team',this,'text')\">&uarr;&darr;</button></th></tr>";
		for(i = 0; i < teamdata.length; i++) {
			playernomination=teamdata[i][0];
			pricepaid=teamdata[i][1];
			team=teamdata[i][2];
			if ((teamname=="All") || (teamname==team)){
			tabledata=tabledata+"<tr><td class=\"hvr\" onclick=\"popup('"+playernomination+"')\">"+playernomination+"</td><td>"+pricepaid+"</td><td>"+team+"</td></tr>"
			}
			}
			if (doc_ready) {
			if (teamname=="All") {
			document.getElementById("leaderboardhdr").innerHTML='<h2 class="chart" OnClick="AddChart(\''+teamname+'\')"><u>Leader Board</u><sup> new</sup></h2>';
			print_grouped_info(fl_points,document.getElementById("leaderboard"),"Team","Points");
			}
			else {
			let cond=fl_points["Team"].eq(teamname);
			let team_points=fl_points.loc({rows: cond});
			let points_total=team_points["Points"].sum();
			if (teamname=="Shitonthevilla") {
			document.getElementById("leaderboardhdr").innerHTML="<h2>Points: "+points_total+"<a>&#128169;</a></h2>";
			}
			else {
			document.getElementById("leaderboardhdr").innerHTML="<h2>Points: "+points_total+"</h2>";
			}
			print_grouped_info(team_points,document.getElementById("leaderboard"),"PlayerNomination","Points");
			}
			}

		document.getElementById("table").innerHTML =tabledata;		
		}
		
	  function AddChart(teamname){
	  console.log("here");
	  let var_teams=fl_points.column('Team').unique();
	  let chartdata=new dfd.DataFrame();
	  for(i = 0; i < var_teams.count(); i++){
		  let cond=fl_points["Team"].eq(var_teams.iat(i));
		  let team_sum=fl_points.loc({rows:cond}).groupby(['GameId']).col(['Points']).sum();
		  //team_sum.setIndex({column: "GameId", inplace: true});
		  team_sum.rename({ "Points_sum": var_teams.iat(i) }, { inplace: true });
		  if (i==0){
			chartdata=team_sum;
		  }
		  else {
			chartdata=dfd.merge({left:chartdata,right:team_sum,on:["GameId"],how:"outer"});
		  }
	  }
	  chartdata=chartdata.cumSum({ axis: 0 });
	  document.getElementById('playernomination').innerHTML="Leader Chart";
	  document.getElementById('pointsinfo').innerHTML="";
	  chartdata.drop({ columns: ["GameId"], inplace: true });
	  //chartdata.asType("GameId", "string",true);
	  //chartdata.setIndex({column: "GameId", drop: true, inplace: true});
	  let swidth=document.getElementById('pointsinfo').width;
	  console.log(swidth);
	  let layout = {legend:{orientation:"h", x:0.2},
					dragmode:"pan",};
	  if (swidth<600){
		layout = {legend:{orientation:"h"},
					dragmode:"pan",
					width:swidth,};
					}
	 
	  chartdata.plot("pointsinfo").line({layout});
	  document.getElementById('id01').style.display='block'
	  }

	  function sortTable_asc(sortcolumn,columnname,node,type="text") {
		  var table, rows, switching, i, x, y, shouldSwitch;
		  //table = document.getElementById("table");
		  table=node.parentNode.parentNode.parentNode;
		  rows = table.rows;
		  var headercol= rows[0].getElementsByTagName("TH")[sortcolumn];
		  headercol.innerHTML=columnname.concat("<button class=\"sortbutton\" onclick=\"sortTable_desc(",sortcolumn,",'",columnname,"',this,'",type,"')\">&uarr;</button>");
		  switching = true;
		  /*Make a loop that will continue until
		  no switching has been done:*/
		  while (switching) {
		    //start by saying: no switching is done:
		    switching = false;
		    rows = table.rows;
		    /*Loop through all table rows (except the
		    first, which contains table headers):*/
		    for (i = 1; i < (rows.length - 1); i++) {
		      //start by saying there should be no switching:
		      shouldSwitch = false;
		      /*Get the two elements you want to compare,
		      one from current row and one from the next:*/
		      x = rows[i].getElementsByTagName("TD")[sortcolumn];
		      y = rows[i + 1].getElementsByTagName("TD")[sortcolumn];
		      //check if the two rows should switch place:
		      if (type=="int"){
			      if (parseInt(x.innerHTML) > parseInt(y.innerHTML)) {
				//if so, mark as a switch and break the loop:
				shouldSwitch = true;
				break;
			      }
		      }
		      else {
		      if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
			//if so, mark as a switch and break the loop:
			shouldSwitch = true;
			break;
		      }
		      }
		    }
		    if (shouldSwitch) {
		      /*If a switch has been marked, make the switch
		      and mark that a switch has been done:*/
		      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
		      switching = true;
		    }
		  }
		}

	  function sortTable_desc(sortcolumn,columnname,node,type="text") {
		  var table, rows, switching, i, x, y, shouldSwitch;
		  //table = document.getElementById("table");
		  table=node.parentNode.parentNode.parentNode;
		  rows = table.rows;
		  var headercol= rows[0].getElementsByTagName("TH")[sortcolumn];
		  headercol.innerHTML=columnname.concat("<button class=\"sortbutton\" onclick=\"sortTable_asc(",sortcolumn,",'",columnname,"',this,'",type,"')\">&darr;</button>");
		  switching = true;
		  /*Make a loop that will continue until
		  no switching has been done:*/
		  while (switching) {
		    //start by saying: no switching is done:
		    switching = false;
		    rows = table.rows;
		    /*Loop through all table rows (except the
		    first, which contains table headers):*/
		    for (i = 1; i < (rows.length - 1); i++) {
		      //start by saying there should be no switching:
		      shouldSwitch = false;
		      /*Get the two elements you want to compare,
		      one from current row and one from the next:*/
		      x = rows[i].getElementsByTagName("TD")[sortcolumn];
		      y = rows[i + 1].getElementsByTagName("TD")[sortcolumn];
		      //check if the two rows should switch place:
		      if (type=="int"){
			      if (parseInt(x.innerHTML) < parseInt(y.innerHTML)) {
				//if so, mark as a switch and break the loop:
				shouldSwitch = true;
				break;
			      }
		      }
		      else {
		      if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
			//if so, mark as a switch and break the loop:
			shouldSwitch = true;
			break;
		      }
		      }
		    }
		    if (shouldSwitch) {
		      /*If a switch has been marked, make the switch
		      and mark that a switch has been done:*/
		      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
		      switching = true;
		    }
		  }
		}	  

	  
	  loadTeamsData();
	  //getscores();

  </script>
 
</head>


   
  <body>
  
    <h1 class="whitetext centertext">Auction 2022</h1>
    <button id="faq" onclick="window.location.href='/Cricket/FantasyLeagueFAQ.html'">FAQs</button>

<div class="players">
	<div>
	<a style="color: white; font-size:90%">Select team to view details!</a></div>
	
		<button class="playerbutton" OnClick="addTeamTable(this)">Thamesis</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">PerfectCoverDrive</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">Shitonthevilla</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">Melchester Rovers</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">Whiter than White</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">Can I Nick It?</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">Stokes Foakes Woakes</button>
		<button class="playerbutton" OnClick="addTeamTable(this)">Lord Stanners waifs</button>
		
	<button class="playerbutton" OnClick="addTeamTable(this)">Clear Selection</button>
	<button class="playerbutton" OnClick="addTeamTable(this)">Games</button>
	</div>
	<div class="frame">
                <div class="framesplit" id="pointsboard">
		<div id="leaderboardhdr"></div>
		<div id="leaderboard"></div>
		</div>
		<div class="framesplit" id="teaminfo">
			<table id="table"></table>
		</div>
		
		<div class="bottom"></div>

	</div>
	
	<div id="id01" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
      <header class="w3-containerh w3-teal"> 
        <span onclick="document.getElementById('id01').style.display='none'" 
        class="w3-button w3-display-topright">&times;</span>
        <h2 id="playernomination">Player points detail</h2>
      </header>
      <div class="w3-container">
        <div id="pointsinfo"></div>
      </div>

    </div>
  </div>
		
  </body>
 
 </html> 
